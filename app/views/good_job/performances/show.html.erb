<div class="border-bottom">
  <h2 class="pt-3 pb-2">Performance</h2>
</div>

<%= form_with(url: "", method: :get, local: true, id: "filter_form", class: "") do |form| %>
  <%= hidden_field_tag :poll, params[:poll] %>
  <%= hidden_field_tag :locale, params[:locale] if params[:locale] %>
  <div class="d-md-flex flex-row w-100">
    <div class="me-md-2 mb-2 mb-md-0">
      <%= label_tag "interval", "Duration", class: "visually-hidden" %>
      <select name="interval" id="interval_filter" class="form-select form-select-sm">
        <option value="second" <%= "selected='selected'" if params[:interval] == "second" %>>Second</option>
        <option value="minute" <%= "selected='selected'" if params[:interval] == "minute" %>>Minute</option>
        <option value="hour" <%= "selected='selected'" if params[:interval] == "hour" %>>Hour</option>
        <option value="day" <%= "selected='selected'" if params[:interval] == "day" %>>Day</option>
      </select>
    </div>

    <div class="me-md-2 mb-2 mb-md-0">
      <%= label_tag "job_queue_filter", "Queue name", class: "visually-hidden" %>
      <select name="queue_name" id="job_queue_filter" class="form-select form-select-sm">
        <option value="" <%= "selected='selected'" if params[:queue_name].blank? %>>All queues</option>

        <% @filter.queues.each do |name, count| %>
          <option value="<%= name.to_param %>" <%= "selected='selected'" if params[:queue_name] == name %>><%= name %> (<%= number_with_delimiter(count, t('good_job.number.format')) %>)</option>
        <% end %>
      </select>
    </div>

    <div class="me-md-2 mb-2 mb-md-0">
      <%= label_tag "job_class_filter", "Job name", class: "visually-hidden" %>
      <select name="job_class" id="job_class_filter" class="form-select form-select-sm">
        <option value="" <%= "selected='selected'" if params[:job_class].blank? %>>All jobs</option>

        <% @filter.job_classes.each do |name, count| %>
          <option value="<%= name.to_param %>" <%= "selected='selected'" if params[:job_class] == name %>><%= name %> (<%= number_with_delimiter(count, t('good_job.number.format')) %>)</option>
        <% end %>
      </select>
    </div>

    <div class="me-md-2 mb-2 mb-md-0 flex-fill">
      <%= label_tag "query", "Search", class: "visually-hidden" %>
      <%= search_field_tag "query", params[:query], class: "form-control form-control-sm", placeholder: "Search by class, job id, job params, and error text." %>
    </div>

    <div class="d-flex flex-col align-items-end">
      <div>
        <%= form.submit "Search", name: nil, class: "btn btn-primary btn-sm" %>
        <%= link_to @filter.to_params(job_class: nil, state: nil, queue_name: nil, query: nil), class: "btn btn-secondary btn-sm" do %>
          Clear
        <% end %>
      </div>
    </div>
  </div>
<% end %>

<br>

<div class="card">
  <div class="card-header">
    Featured
  </div>
  <div class="card-body">
    <%= render 'good_job/shared/chart', chart_data: @latency_chart.data %>
  </div>
</div>

